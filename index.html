<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taxi-Line | Pro Live Tracking</title>
    
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" render="explicit" async defer></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        :root { --yellow: #FFD700; --dark: #333; --light: #fffde7; --gold: #8B8000; --red: #d9534f; }
        body { background-color: #FFFFE0; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; text-align: center; color: var(--dark); }
        
        .navbar { display: flex; justify-content: flex-end; padding: 10px 20px; gap: 10px; }
        .flag { width: 25px; cursor: pointer; border: 1px solid #ccc; }

        .container { background: transparent; padding: 20px; max-width: 500px; margin: 0 auto; }
        .brand-icon { font-size: 55px; margin-bottom: 5px; }
        h1 { margin: 5px 0; color: var(--gold); font-size: 35px; text-shadow: 1px 1px 2px rgba(0,0,0,0.1); }
        .slogan { font-style: italic; color: #555; margin-bottom: 25px; font-size: 14px; line-height: 1.4; }

        .btn { width: 95%; padding: 16px; margin: 10px 0; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 17px; transition: 0.3s; box-shadow: 0 4px 0 #ccac00; }
        .btn-yellow { background: var(--yellow); color: #333; }
        .btn-yellow:active { transform: translateY(3px); box-shadow: none; }
        .btn-dark { background: #333; color: white; box-shadow: 0 4px 0 #000; }
        
        input { width: 85%; padding: 14px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; background-color: white; font-size: 16px; }

        #map-area { height: 400px; width: 100%; border-radius: 15px; border: 3px solid var(--gold); margin: 20px 0; box-shadow: 0 6px 15px rgba(0,0,0,0.15); }
        
        .support-info { margin-top: 30px; font-size: 14px; color: #444; border-top: 1px solid #ddd; padding-top: 20px; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div class="navbar">
        <img src="https://flagcdn.com/w40/gr.png" class="flag" title="Î•Î»Î»Î·Î½Î¹ÎºÎ¬">
        <img src="https://flagcdn.com/w40/us.png" class="flag" title="English">
    </div>

    <div id="login-screen" class="container">
        <div class="brand-icon">ğŸš•</div>
        <h1>Taxi-Line</h1>
        <p class="slogan">Your friendly taxi service - we connect passengers with drivers quickly and easily</p>
        
        <input type="email" id="login-email" placeholder="Email (akisss70@yahoo.com)">
        <input type="password" id="login-pass" placeholder="Password">
        <div id="login-err" class="hidden" style="color:var(--red); font-weight:bold; margin:10px;"></div>
        
        <button class="btn btn-yellow" onclick="attemptLogin()">Sign Up / Log In</button>
        <p>ÎÎ­Î¿Ï‚ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚; <a href="#" onclick="showView('register-screen')" style="color:var(--gold); font-weight:bold;">Î•Î³Î³ÏÎ±Ï†Î®</a></p>
        
        <div class="support-info">
            Do you have questions or need support? Contact us!<br>
            <b>Email: support@taxi-line.com</b><br>
            <b>ğŸ“ +30 6999222446</b>
        </div>
    </div>

    <div id="main-hub" class="hidden container">
        <div class="brand-icon">ğŸš•</div>
        <h1>Taxi-Line</h1>
        <p class="slogan">ÎšÎ±Î»ÏÏ‚ Î®ÏÎ¸Î±Ï„Îµ ÏƒÏ„Î¿ ÎºÎ­Î½Ï„ÏÎ¿ ÎµÎ»Î­Î³Ï‡Î¿Ï…</p>
        
        <button class="btn btn-yellow" onclick="startLiveTracking()">Passenger Dashboard</button>
        <button class="btn btn-yellow" onclick="alert('Î£ÏÎ½Ï„Î¿Î¼Î± Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿ Î³Î¹Î± Î¿Î´Î·Î³Î¿ÏÏ‚!')">Driver Dashboard</button>
        <button class="btn btn-dark" onclick="alert('Î ÏÏŒÏƒÎ²Î±ÏƒÎ· Î¼ÏŒÎ½Î¿ Î³Î¹Î± Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î­Ï‚')">Administrator Dashboard</button>
        
        <div class="support-info">
            Î¥Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î·: support@taxi-line.com<br>
            <b>ğŸ“ +30 6999222446</b>
        </div>
        <button class="btn" onclick="location.reload()" style="background:#eee; font-size:12px; box-shadow:none;">Logout</button>
    </div>

    <div id="passenger-view" class="hidden container" style="max-width: 95%;">
        <h3>ğŸ“ Î–Ï‰Î½Ï„Î±Î½Î® Î¤Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î±</h3>
        <div id="map-area"></div>
        <button class="btn btn-yellow" onclick="alert('Î¤Î¿ Î±Î¯Ï„Î·Î¼Î± ÏƒÏ„Î¬Î»Î¸Î·ÎºÎµ!')">ğŸš• ÎšÎ»Î®ÏƒÎ· Î¤Î±Î¾Î¯</button>
        <button class="btn" onclick="stopLiveTracking()" style="background:#eee; box-shadow:none;">Î Î¯ÏƒÏ‰ ÏƒÏ„Î¿ ÎœÎµÎ½Î¿Ï</button>
    </div>

    <div id="register-screen" class="hidden container">
        <h2>ÎÎ­Î¿Ï‚ Î›Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒÏ‚</h2>
        <input type="email" id="reg-email" placeholder="Email">
        <button class="btn btn-yellow" onclick="processRegistration()">Î•Î³Î³ÏÎ±Ï†Î®</button>
        <button class="btn" onclick="showView('login-screen')" style="box-shadow:none;">Î Î¯ÏƒÏ‰</button>
    </div>

    <div id="verify-screen" class="hidden container">
        <div style="font-size:50px;">ğŸ“§</div>
        <h2>Î•Ï€Î¹Î²ÎµÎ²Î±Î¯Ï‰ÏƒÎ· Email</h2>
        <p>Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ»Î­Î³Î¾Ï„Îµ Ï„Î± ÎµÎ¹ÏƒÎµÏÏ‡ÏŒÎ¼ÎµÎ½Î¬ ÏƒÎ±Ï‚ Î³Î¹Î± Î½Î± ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·.</p>
        <button class="btn btn-yellow" onclick="location.reload()">ÎŸÎ»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ</button>
    </div>

    <script>
    const API_TOKEN = "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJhdWQiOiI0IiwianRpIjoiMzE0N2MxZGQ1ZWRhOGJmNmI0ZmU3MDdkMjYyNWVkODMxYzIxNjc5OWYxOTQ0OTMwNTFmOTU3YmJkNmUwYWU2MDAwM2Q3MTEyMTgzYTAzMzgiLCJpYXQiOjE3NzE3OTg1NTguNDg0MTc0LCJuYmYiOjE3NzE3OTg1NTguNDg0MTc3LCJleHAiOjQ5Mjc0NzIxNTguNDc1NTYzLCJzdWIiOiIyMTUxNDUwIiwic2NvcGVzIjpbXX0.wSW95HXK43Rn4cQBNHMcOc0jCr6VTw8MDQxegUso8OSsaabMNbnLNE4fTSaDeuvK4sS7cet_cp6dY4-DC3qUt6OzJTzVMlwgQ4r12qXKDFZOr1XATkPNWBLMstv7_Kj1f-swF736jUxSOZBlfermR5OcnkLew6GuEcGyQFJ_h3FeBA5nrZjN1zVn5Vdw8IFex0MfSHGmBDpVkXrczz9xYV9OLOxcc9g5H9FfR7P9fpFtmlVvjL7X4jQpZxaztgX8B-hEfEHrAmVqq2E3GPEydOT-tFf3okiHqSzUoOABA_BhlEIpOghOLfaJiUQsIQdnxtipYm20Fqm--DQpJt7HgKm92xul1hCqLB_g_462ev3jXQTPmukYnZ4v2iQZQ_TM7kHLL6qNXkZ0-o6K40Yg05iYVnz1dl8ae8t4l5p_uin9_HWmzRraGMm0bNzL98gYGfbwQa9-RK3RJjzGH7dY6715quchq9u19Z7-ezP1CN1o_jNDkC-2dnr1cA-tG7ddzBASH-S_lhNt1D4-gprOcRbh5sQ07f5hN0Uk8-ngamrGNNDytACNHSgtjJjJ-uKNv58QbY-hFmy_47b78O4nlCBOUXJcKbIs6EVaZz9WT-7mBl_ZqQRv9yfnR9HiZHZ-raBT26c1eU3Kiy60ZT8-8qQQId1VIotYy5JmpYGGoxw";
    const GROUP_ID = "180133767592019782";
    let map, userMarker, watchId;

    function showView(id) {
        document.querySelectorAll('.container').forEach(c => c.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
    }

    async function attemptLogin() {
        const email = document.getElementById('login-email').value;
        const pass = document.getElementById('login-pass').value;
        if(pass === "Aggelos2026!") { showView('main-hub'); return; }

        try {
            const response = await fetch(`https://connect.mailerlite.com/api/subscribers/${email}`, {
                method: 'GET', headers: { 'Authorization': `Bearer ${API_TOKEN}` }
            });
            const result = await response.json();
            if (result.data && result.data.status === 'active') showView('main-hub');
            else alert("Î•ÎºÎºÏÎµÎ¼ÎµÎ¯ ÎµÏ€Î¹Î²ÎµÎ²Î±Î¯Ï‰ÏƒÎ· email!");
        } catch (e) { alert("Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚."); }
    }

    function startLiveTracking() {
        if (!navigator.geolocation) return alert("Î¤Î¿ GPS Î´ÎµÎ½ Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶ÎµÏ„Î±Î¹.");

        showView('passenger-view');
        
        // Î‘ÏÏ‡Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· Ï‡Î¬ÏÏ„Î· (ÎºÎµÎ½ÏŒ)
        if (!map) {
            map = L.map('map-area').setView([38.2466, 21.7346], 14); // Default Patras
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        }

        // Live Watch
        watchId = navigator.geolocation.watchPosition(
            (pos) => {
                const { latitude, longitude } = pos.coords;
                const newPos = [latitude, longitude];

                if (!userMarker) {
                    userMarker = L.marker(newPos).addTo(map).bindPopup("Î•Î¯ÏƒÏ„Îµ ÎµÎ´Ï").openPopup();
                    L.circle(newPos, { radius: 5000, color: 'gold', fillOpacity: 0.1 }).addTo(map);
                } else {
                    userMarker.setLatLng(newPos);
                }
                map.setView(newPos, 14);
            },
            (err) => alert("Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ Ï„Î¿ GPS."),
            { enableHighAccuracy: true }
        );
    }

    function stopLiveTracking() {
        if (watchId) navigator.geolocation.clearWatch(watchId);
        showView('main-hub');
    }

    async function processRegistration() {
        const email = document.getElementById('reg-email').value;
        try {
            await fetch('https://connect.mailerlite.com/api/subscribers', {
                method: 'POST',
                headers: { 'Authorization': `Bearer ${API_TOKEN}`, 'Content-Type': 'application/json' },
                body: JSON.stringify({ email: email, groups: [GROUP_ID], status: "unconfirmed" })
            });
            showView('verify-screen');
        } catch(e) { alert("Î£Ï†Î¬Î»Î¼Î± ÎµÎ³Î³ÏÎ±Ï†Î®Ï‚."); }
    }
    </script>
</body>
</html>
