<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taxi-Line | Pro Production</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        :root { --yellow: #FFD700; --dark: #333; --light: #fffde7; --gold: #8B8000; --red: #d9534f; --green: #28a745; }
        body { background-color: #FFFFE0; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; text-align: center; color: var(--dark); }
        .navbar { display: flex; justify-content: flex-end; padding: 10px 20px; gap: 10px; }
        .flag { width: 25px; cursor: pointer; border: 1px solid #ccc; }
        .container { padding: 20px; max-width: 500px; margin: 0 auto; }
        .hidden { display: none !important; }
        .brand-icon { font-size: 55px; margin-bottom: 5px; }
        h1 { color: var(--gold); font-size: 35px; margin: 5px 0; }
        .slogan { font-style: italic; color: #555; margin-bottom: 25px; font-size: 14px; }
        
        /* Buttons */
        .btn { width: 95%; padding: 16px; margin: 10px 0; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 17px; transition: 0.3s; box-shadow: 0 4px 0 rgba(0,0,0,0.2); }
        .btn-yellow { background: var(--yellow); color: #333; }
        .btn-green { background: var(--green); color: white; }
        .btn-red { background: var(--red); color: white; }
        .btn-dark { background: #333; color: white; }
        .btn:active { transform: translateY(3px); box-shadow: none; }

        /* Map & Cards */
        #map-area, #driver-map { height: 350px; width: 100%; border-radius: 15px; border: 3px solid var(--gold); margin: 20px 0; box-shadow: 0 6px 15px rgba(0,0,0,0.1); }
        .request-card { background: white; border-left: 5px solid var(--gold); padding: 15px; margin: 10px 0; text-align: left; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        input { width: 85%; padding: 14px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; }
        .support-info { margin-top: 30px; font-size: 13px; color: #444; border-top: 1px solid #ddd; padding-top: 15px; }
    </style>
</head>
<body>

    <div class="navbar">
        <img src="https://flagcdn.com/w40/gr.png" class="flag">
        <img src="https://flagcdn.com/w40/us.png" class="flag">
    </div>

    <div id="login-screen" class="container">
        <div class="brand-icon">ğŸš•</div>
        <h1>Taxi-Line</h1>
        <p class="slogan">Your friendly taxi service</p>
        <input type="email" id="login-email" placeholder="Email">
        <input type="password" id="login-pass" placeholder="Password">
        <button class="btn btn-yellow" onclick="attemptLogin()">Sign Up / Log In</button>
        <div class="support-info">Email: support@taxi-line.com | ğŸ“ +30 6999222446</div>
    </div>

    <div id="main-hub" class="hidden container">
        <div class="brand-icon">ğŸš•</div>
        <h1>Taxi-Line</h1>
        <button class="btn btn-yellow" onclick="showView('passenger-view'); initPassengerMap();">Passenger Dashboard</button>
        <button class="btn btn-yellow" onclick="showView('driver-dashboard')">Driver Dashboard</button>
        <button class="btn btn-dark" onclick="showView('admin-dashboard')">Administrator Dashboard</button>
        <button class="btn" onclick="location.reload()" style="background:#eee; box-shadow:none;">Logout</button>
    </div>

    <div id="passenger-view" class="hidden container">
        <h3>ğŸ“ Î¤Î±Î¾Î¯ ÎºÎ¿Î½Ï„Î¬ ÏƒÎ±Ï‚</h3>
        <div id="map-area"></div>
        <button class="btn btn-yellow" onclick="sendRideRequest()">ğŸš• ÎšÎ»Î®ÏƒÎ· Î¤Î±Î¾Î¯</button>
        <button class="btn" onclick="showView('main-hub')">Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î®</button>
    </div>

    <div id="driver-dashboard" class="hidden container">
        <h2>ğŸ‘¨â€âœˆï¸ Î Î¯Î½Î±ÎºÎ±Ï‚ ÎŸÎ´Î·Î³Î¿Ï</h2>
        <button id="toggle-btn" class="btn btn-green" onclick="toggleDriverOnline()">Go Online</button>
        <div id="driver-map" class="hidden"></div>
        <div id="incoming-requests">
            <h4>Î•Î¹ÏƒÎµÏÏ‡ÏŒÎ¼ÎµÎ½ÎµÏ‚ ÎšÎ»Î®ÏƒÎµÎ¹Ï‚:</h4>
            <div id="no-requests">Î‘Î½Î±Î¼Î¿Î½Î® Î³Î¹Î± ÎµÏ€Î¹Î²Î¬Ï„ÎµÏ‚...</div>
        </div>
        <button class="btn" onclick="stopDriverMode()">Î Î¯ÏƒÏ‰</button>
    </div>

    <div id="admin-dashboard" class="hidden container">
        <h2>ğŸ‘‘ Admin Panel</h2>
        <button class="btn btn-red" onclick="clearAllData()">ğŸ—‘ï¸ ÎšÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒÏ‚ Î’Î¬ÏƒÎ·Ï‚</button>
        <div id="admin-requests-list" style="margin-top:20px;"></div>
        <button class="btn" onclick="showView('main-hub')">Î Î¯ÏƒÏ‰</button>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <script>
        // FIREBASE CONFIGURATION (The ones you provided)
        const firebaseConfig = {
            apiKey: "AIzaSyCCzXoeqv3VODlSH6j3HrqI36ixYYdEjjI",
            authDomain: "taxi-line-f149e.firebaseapp.com",
            databaseURL: "https://taxi-line-f149e-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "taxi-line-f149e",
            storageBucket: "taxi-line-f149e.firebasestorage.app",
            messagingSenderId: "1086896421565",
            appId: "1:1086896421565:web:e498b8916fd95a04e7d5d4"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let map, driverMap, userMarker, driverMarker, passengerMarker, watchId;
        let isOnline = false;

        function showView(id) {
            document.querySelectorAll('.container').forEach(c => c.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        }

        function attemptLogin() {
            const pass = document.getElementById('login-pass').value;
            if(pass === "Aggelos2026!") showView('main-hub');
            else alert("Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚!");
        }

        // PASSENGER LOGIC
        function initPassengerMap() {
            navigator.geolocation.getCurrentPosition(pos => {
                const coords = [pos.coords.latitude, pos.coords.longitude];
                if(!map) {
                    map = L.map('map-area').setView(coords, 14);
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
                }
                L.marker(coords).addTo(map).bindPopup("Î•ÏƒÎµÎ¯Ï‚").openPopup();
