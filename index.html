<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taxi-Line | Management System</title>
    <style>
        :root { --yellow: #FFD700; --dark: #333; --light: #f4f4f4; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--light); margin: 0; padding: 20px; text-align: center; }
        .container { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); max-width: 500px; margin: 20px auto; }
        .hidden { display: none !important; }
        .btn { padding: 12px 24px; margin: 10px; cursor: pointer; border: none; border-radius: 8px; font-weight: bold; transition: 0.3s; }
        .btn-yellow { background: var(--yellow); color: black; }
        .btn-yellow:hover { background: #e6c200; }
        .btn-dark { background: var(--dark); color: white; }
        input { width: 80%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { padding: 12px; border-bottom: 1px solid #eee; text-align: left; }
        .stars { font-size: 35px; color: var(--yellow); cursor: pointer; margin: 15px 0; }
        footer { margin-top: 40px; font-size: 13px; color: #888; border-top: 1px solid #ccc; padding-top: 20px; }

        #map-area {
            height: 400px; 
            width: 100%;
            border: 2px solid #333;
            border-radius: 8px;
            z-index: 1;
            margin-top: 10px;
        }
    </style>

    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" render="explicit" async defer></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>

<div id="main-content" class="container">
    <h1 style="color:var(--dark)">Taxi-Line</h1>
    <div id="auth-section">
        <p>Please enter your credentials</p>
        <input type="email" id="user-input" placeholder="Email Address">
        <input type="password" id="pass-input" placeholder="Password (8+ chars)">
        <br>
        <button class="btn btn-yellow" onclick="handleLogin()">Sign Up / Log In</button>
    </div>
</div>

<div id="dashboards" class="hidden container">
    <h2>Access Control Hub</h2>
    <p>Select your dashboard role:</p>
    <button class="btn btn-yellow" onclick="showView('passenger')">Passenger</button>
    <button class="btn btn-yellow" onclick="showView('driver')">Driver</button>
    <button class="btn btn-dark" onclick="showView('admin')">Head-Admin</button>
</div>

<div id="passenger-view" class="hidden container">
    <h2 id="pass-title">Live Tracking (Athens)</h2>
    <div id="map-area"></div>
    
    <div id="rating-section" class="hidden">
        <h3>Rate your Ride</h3>
        <div class="stars">
            <span onclick="submitRating(1)">★</span><span onclick="submitRating(2)">★</span><span onclick="submitRating(3)">★</span><span onclick="submitRating(4)">★</span><span onclick="submitRating(5)">★</span>
        </div>
    </div>

    <button id="finish-btn" class="btn btn-yellow" onclick="endRide()">Finish Ride</button>
    <button class="btn btn-dark" onclick="location.reload()">Logout</button>
</div>

<div id="driver-view" class="hidden container">
    <h2>Driver Dashboard</h2>
    <p>Status: <span style="color: green;">Available</span></p>
    <button class="btn btn-dark" onclick="location.reload()">Logout</button>
</div>

<div id="admin-view" class="hidden container">
    <h2>Head-Administrator</h2>
    <button class="btn btn-dark" onclick="location.reload()">Back</button>
</div>

<footer>
    <p>Support: support@taxi-line.com | Phone: +30 6999222446</p>
    <p>Copyright 2026 Taxi-Line Services.</p>
</footer>

<script>
var map;
var taxiMarker;
var moveInterval;

function handleLogin() {
    var p = document.getElementById('pass-input').value;
    if (p.length >= 8) {
        document.getElementById('auth-section').innerHTML = 
            '<h3>Security Check</h3>' +
            '<div id="turnstile-container" style="margin-bottom:15px; display:flex; justify-content:center;"></div>' + 
            '<button id="bypass-btn" class="btn btn-yellow" onclick="bypass()" disabled>Wait for Verification...</button>';
        
        if (window.turnstile) {
            turnstile.render('#turnstile-container', {
                sitekey: '0x4AAAAAACgb7i5zYwkXn5g5',
                callback: function(token) {
                    document.getElementById('bypass-btn').disabled = false;
                    document.getElementById('bypass-btn').innerText = "Bypass to Dashboards";
                },
            });
        }
    } else {
        alert("Password must be at least 8 characters long.");
    }
}

function bypass() {
    // FIXED: Correct ID 'dashboards'
    document.getElementById('main-content').classList.add('hidden');
    document.getElementById('dashboards').classList.remove('hidden');
}

function showView(v) {
    document.getElementById('dashboards').classList.add('hidden');
    
    if(v === 'passenger') {
        document.getElementById('passenger-view').classList.remove('hidden');
        initMap();
    } else if(v === 'driver') {
        document.getElementById('driver-view').classList.remove('hidden');
    } else if(v === 'admin') {
        document.getElementById('admin-view').classList.remove('hidden');
    }
}

function initMap() {
    // Only init if map doesn't exist
    if (!map) {
        map = L.map('map-area').setView([37.9838, 23.7275], 15);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        var taxiIcon = L.icon({
            iconUrl: 'https://cdn-icons-png.flaticon.com/512/3448/3448339.png',
            iconSize: [45, 45],
            iconAnchor: [22, 45]
        });

        taxiMarker = L.marker([37.9838, 23.7275], {icon: taxiIcon}).addTo(map);
        startRealMovement();
    }
}

function startRealMovement() {
    let lat = 37.9838;
    let lng = 23.7275;
    moveInterval = setInterval(() => {
        lat += (Math.random() - 0.5) * 0.0005;
        lng += (Math.random() - 0.5) * 0.0005;
        taxiMarker.setLatLng([lat, lng]);
    }, 2000);
}

function endRide() {
    document.getElementById('rating-section').classList.remove('hidden');
    document.getElementById('finish-btn').classList.add('hidden');
    clearInterval(moveInterval);
}

function submitRating(s) {
    alert("Thanks for the " + s + " star rating!");
    
    // 1. Hide the Passenger View
    document.getElementById('passenger-view').classList.add('hidden');
    
    // 2. Show the Selection Dashboard again
    document.getElementById('dashboards').classList.remove('hidden');
    
    // 3. Reset the Rating Section for next time
    document.getElementById('rating-section').classList.add('hidden');
    document.getElementById('finish-btn').classList.remove('hidden');

    // 4. Stop the map and movement completely
    if (moveInterval) clearInterval(moveInterval);
    if (map) {
        map.remove(); // This "destroys" the map so we can recreate it fresh later
        map = null;   // Reset the variable
    }
}
</script>
</body>
</html>


