<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taxi-Line | Connecting Passengers & Drivers</title>
    
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" render="explicit" async defer></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        :root { --yellow: #FFD700; --dark: #333; --light: #FFFFE0; --gold: #8B8000; --red: #d9534f; --green: #28a745; }
        body { background-color: var(--light); font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 0; text-align: center; color: var(--dark); }
        
        /* Navbar Î¼Îµ ÏƒÎ·Î¼Î±Î¯ÎµÏ‚ */
        .navbar { display: flex; justify-content: flex-end; padding: 10px 20px; gap: 10px; }
        .flag { width: 25px; cursor: pointer; border-radius: 2px; box-shadow: 0 1px 3px rgba(0,0,0,0.2); }

        .container { background: transparent; padding: 20px; max-width: 450px; margin: 0 auto; }
        .brand-icon { font-size: 50px; margin-bottom: 5px; }
        h1 { margin: 5px 0; color: var(--gold); font-size: 32px; }
        .slogan { font-style: italic; color: #555; margin-bottom: 25px; line-height: 1.4; }

        input, select { 
            width: 85%; 
            padding: 14px; 
            margin: 8px 0; 
            border: 1px solid #ddd; 
            border-radius: 8px; 
            background-color: #fffde7; /* Î•Î»Î±Ï†ÏÏ ÎºÎ¯Ï„ÏÎ¹Î½Î¿ Î±Ï€ÏŒ Ï„Î¿ Ï€Î±Î»Î¹ÏŒ design */
            font-size: 16px;
        }

        .btn { width: 90%; padding: 15px; margin: 15px 0; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 18px; transition: 0.3s; }
        .btn-yellow { background: var(--yellow); color: #333; box-shadow: 0 4px 0 #ccac00; }
        .btn-yellow:active { transform: translateY(3px); box-shadow: none; }
        
        .support-info { margin-top: 40px; font-size: 14px; color: #444; border-top: 1px solid #ddd; padding-top: 20px; }
        .support-info b { display: block; margin-bottom: 10px; }
        .hidden { display: none !important; }

        #map-area { height: 350px; width: 100%; border-radius: 12px; border: 2px solid var(--gold); margin-top: 15px; }
    </style>
</head>
<body>

    <div class="navbar">
        <img src="https://flagcdn.com/w40/gr.png" class="flag" alt="EL">
        <img src="https://flagcdn.com/w40/us.png" class="flag" alt="EN">
    </div>

    <div id="login-screen" class="container">
        <div class="brand-icon">ğŸš•</div>
        <h1>Taxi-Line</h1>
        <p class="slogan">Your friendly taxi service - we connect passengers with drivers quickly and easily</p>

        <div id="login-form">
            <input type="email" id="login-email" placeholder="Email (Ï€.Ï‡. akisss70@yahoo.com)">
            <input type="password" id="login-pass" placeholder="Password">
            <div id="login-err" class="hidden" style="color:var(--red); font-weight:bold; margin:10px;"></div>
            
            <button class="btn btn-yellow" id="login-btn" onclick="attemptLogin()">Sign Up / Log In</button>
            
            <div id="login-loader" class="hidden">
                <p>âŒ› Î Î±ÏÎ±ÎºÎ±Î»Ï Ï€ÎµÏÎ¹Î¼Î­Î½ÎµÏ„Îµ...</p>
            </div>
            
            <p>ÎÎ­Î¿Ï‚ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚; <a href="#" onclick="showView('register-screen')" style="color:var(--gold); font-weight:bold;">Î•Î³Î³ÏÎ±Ï†Î® ÎµÎ´Ï</a></p>
        </div>

        <div id="security-box" class="hidden">
            <p>Î¤ÎµÎ»Î¹ÎºÎ® ÎµÏ€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ· Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚:</p>
            <div id="turnstile-container" style="display:flex; justify-content:center;"></div>
        </div>

        <div class="support-info">
            <b>Do you have questions or need support? Contact us!</b>
            Email: support@taxi-line.com<br>
            ğŸ“ +30 6999222446
        </div>
    </div>

    <div id="register-screen" class="hidden container">
        <h2>Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î›Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼Î¿Ï</h2>
        <input type="text" id="reg-name" placeholder="ÎŒÎ½Î¿Î¼Î±">
        <input type="email" id="reg-email" placeholder="Email">
        <input type="password" id="reg-pass" placeholder="Password (8+ Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÎµÏ‚)">
        <select id="reg-role">
            <option value="passenger">Î•Ï€Î¹Î²Î¬Ï„Î·Ï‚</option>
            <option value="driver">ÎŸÎ´Î·Î³ÏŒÏ‚ Î¤Î±Î¾Î¯</option>
        </select>
        <button class="btn btn-yellow" id="reg-btn" onclick="processRegistration()">Î•Î³Î³ÏÎ±Ï†Î® & Email Î•Ï€Î¹Î²ÎµÎ²Î±Î¯Ï‰ÏƒÎ·Ï‚</button>
        <button class="btn" onclick="location.reload()">Î Î¯ÏƒÏ‰</button>
    </div>

    <div id="verify-screen" class="hidden container">
        <div style="font-size: 60px;">ğŸ“§</div>
        <h2>Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î¿ Email ÏƒÎ±Ï‚!</h2>
        <p>Î£Î±Ï‚ ÏƒÏ„ÎµÎ¯Î»Î±Î¼Îµ Î­Î½Î±Î½ ÏƒÏÎ½Î´ÎµÏƒÎ¼Î¿. Î ÏÎ­Ï€ÎµÎ¹ Î½Î± Ï„Î¿Î½ Ï€Î±Ï„Î®ÏƒÎµÏ„Îµ Î³Î¹Î± Î½Î± ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î¿ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒÏ‚ ÏƒÎ±Ï‚.</p>
        <button class="btn btn-yellow" onclick="location.reload()">Î•Ï€Î­ÏƒÏ„ÏÎµÏˆÎ± - Î•Î¯ÏƒÎ¿Î´Î¿Ï‚</button>
    </div>

    <div id="passenger-dashboard" class="hidden container" style="max-width: 90%;">
        <h3>ğŸ“ Î¤Î±Î¾Î¯ ÎºÎ¿Î½Ï„Î¬ ÏƒÎ±Ï‚</h3>
        <div id="map-area"></div>
        <button class="btn btn-yellow" onclick="alert('Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Î¿Î´Î·Î³Î¿Ï...')">ğŸš• ÎšÎ»Î®ÏƒÎ· Î¤Î±Î¾Î¯</button>
        <button class="btn" onclick="location.reload()">Logout</button>
    </div>

    <script>
    const API_TOKEN = "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJhdWQiOiI0IiwianRpIjoiMzE0N2MxZGQ1ZWRhOGJmNmI0ZmU3MDdkMjYyNWVkODMxYzIxNjc5OWYxOTQ0OTMwNTFmOTU3YmJkNmUwYWU2MDAwM2Q3MTEyMTgzYTAzMzgiLCJpYXQiOjE3NzE3OTg1NTguNDg0MTc0LCJuYmYiOjE3NzE3OTg1NTguNDg0MTc3LCJleHAiOjQ5Mjc0NzIxNTguNDc1NTYzLCJzdWIiOiIyMTUxNDUwIiwic2NvcGVzIjpbXX0.wSW95HXK43Rn4cQBNHMcOc0jCr6VTw8MDQxegUso8OSsaabMNbnLNE4fTSaDeuvK4sS7cet_cp6dY4-DC3qUt6OzJTzVMlwgQ4r12qXKDFZOr1XATkPNWBLMstv7_Kj1f-swF736jUxSOZBlfermR5OcnkLew6GuEcGyQFJ_h3FeBA5nrZjN1zVn5Vdw8IFex0MfSHGmBDpVkXrczz9xYV9OLOxcc9g5H9FfR7P9fpFtmlVvjL7X4jQpZxaztgX8B-hEfEHrAmVqq2E3GPEydOT-tFf3okiHqSzUoOABA_BhlEIpOghOLfaJiUQsIQdnxtipYm20Fqm--DQpJt7HgKm92xul1hCqLB_g_462ev3jXQTPmukYnZ4v2iQZQ_TM7kHLL6qNXkZ0-o6K40Yg05iYVnz1dl8ae8t4l5p_uin9_HWmzRraGMm0bNzL98gYGfbwQa9-RK3RJjzGH7dY6715quchq9u19Z7-ezP1CN1o_jNDkC-2dnr1cA-tG7ddzBASH-S_lhNt1D4-gprOcRbh5sQ07f5hN0Uk8-ngamrGNNDytACNHSgtjJjJ-uKNv58QbY-hFmy_47b78O4nlCBOUXJcKbIs6EVaZz9WT-7mBl_ZqQRv9yfnR9HiZHZ-raBT26c1eU3Kiy60ZT8-8qQQId1VIotYy5JmpYGGoxw";
    const GROUP_ID = "180133767592019782"; 
    const OWNER_PASS = "Aggelos2026!";

    function showView(id) {
        document.querySelectorAll('.container').forEach(c => c.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
    }

    async function attemptLogin() {
        const email = document.getElementById('login-email').value;
        const pass = document.getElementById('login-pass').value;
        const err = document.getElementById('login-err');

        if(pass === OWNER_PASS) { showView('passenger-dashboard'); initMap(); return; }

        document.getElementById('login-btn').classList.add('hidden');
        document.getElementById('login-loader').classList.remove('hidden');

        try {
            const response = await fetch(`https://connect.mailerlite.com/api/subscribers/${email}`, {
                method: 'GET',
                headers: { 'Authorization': `Bearer ${API_TOKEN}` }
            });
            const result = await response.json();

            if (result.data && result.data.status === 'active') {
                document.getElementById('login-form').classList.add('hidden');
                document.getElementById('security-box').classList.remove('hidden');
                turnstile.render('#turnstile-container', {
                    sitekey: '0x4AAAAAACgb7i5zYwkXn5g5',
                    callback: () => { showView('passenger-dashboard'); initMap(); }
                });
            } else { throw new Error(); }
        } catch (e) {
            document.getElementById('login-btn').classList.remove('hidden');
            document.getElementById('login-loader').classList.add('hidden');
            err.innerText = "âŒ Î ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÏ€Î¹Î²ÎµÎ²Î±Î¹ÏÏƒÎµÏ„Îµ Ï„Î¿ email ÏƒÎ±Ï‚ Ï€ÏÏÏ„Î±!";
            err.classList.remove('hidden');
        }
    }

    function initMap() {
        navigator.geolocation.getCurrentPosition((pos) => {
            const lat = pos.coords.latitude;
            const lon = pos.coords.longitude;
            const map = L.map('map-area').setView([lat, lon], 14);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
            L.marker([lat, lon]).addTo(map).bindPopup("Î•ÏƒÎµÎ¯Ï‚");
            L.circle([lat, lon], { radius: 5000, color: 'gold', fillOpacity: 0.1 }).addTo(map);
        });
    }

    async function processRegistration() {
        const email = document.getElementById('reg-email').value;
        document.getElementById('reg-btn').innerText = "Î Î±ÏÎ±ÎºÎ±Î»Ï Ï€ÎµÏÎ¹Î¼Î­Î½ÎµÏ„Îµ...";
        try {
            await fetch('https://connect.mailerlite.com/api/subscribers', {
                method: 'POST',
                headers: { 'Authorization': `Bearer ${API_TOKEN}`, 'Content-Type': 'application/json' },
                body: JSON.stringify({ email: email, groups: [GROUP_ID], status: "unconfirmed" })
            });
            showView('verify-screen');
        } catch(e) { alert("Î£Ï†Î¬Î»Î¼Î± ÏƒÏ„Î·Î½ ÎµÎ³Î³ÏÎ±Ï†Î®."); location.reload(); }
    }
    </script>
</body>
</html>
