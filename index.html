<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taxi-Line | Pro Edition</title>
    
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" render="explicit" async defer></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        :root { --yellow: #FFD700; --dark: #333; --light: #FFFFE0; --gold: #8B8000; --red: #d9534f; }
        body { background-color: var(--light); font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; padding-bottom: 70px; text-align: center; color: var(--dark); }
        .container { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); max-width: 450px; margin: 20px auto; }
        .hidden { display: none !important; }
        .btn { width: 90%; padding: 14px; margin: 10px 0; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; text-decoration: none; display: inline-block; }
        .btn-yellow { background: var(--yellow); color: black; }
        .btn-dark { background: var(--dark); color: white; }
        input, select { width: 85%; padding: 12px; margin: 8px 0; border: 1px solid #ccc; border-radius: 5px; }
        .error-box { background: #f8d7da; color: #721c24; padding: 10px; border-radius: 5px; margin: 10px 0; font-size: 14px; border: 1px solid #f5c6cb; }
        
        /* Nav Bar */
        .nav-bar { position: fixed; bottom: 0; width: 100%; background: white; display: flex; border-top: 2px solid var(--yellow); height: 65px; align-items: center; z-index: 1000; }
        .nav-item { flex: 1; cursor: pointer; font-size: 11px; }
        #map-area { height: 350px; width: 100%; border-radius: 10px; border: 2px solid var(--gold); }
    </style>
</head>
<body>

    <div id="home-screen" class="container">
        <div style="font-size: 50px;">ğŸš•</div>
        <h1 style="color:var(--gold)">Taxi-Line</h1>
        <p id="app-desc">Î— Ï†Î¹Î»Î¹ÎºÎ® ÏƒÎ±Ï‚ Ï…Ï€Î·ÏÎµÏƒÎ¯Î± Ï„Î±Î¾Î¯ - ÏƒÏ…Î½Î´Î­Î¿Ï…Î¼Îµ ÎµÏ€Î¹Î²Î¬Ï„ÎµÏ‚ Î¼Îµ Î¿Î´Î·Î³Î¿ÏÏ‚ Î³ÏÎ®Î³Î¿ÏÎ± ÎºÎ±Î¹ ÎµÏÎºÎ¿Î»Î±</p>
        
        <div id="login-form">
            <input type="email" id="login-email" placeholder="Email">
            <input type="password" id="login-pass" placeholder="Password">
            <div id="login-err" class="error-box hidden">âŒ Î ÏÏŒÏƒÎ²Î±ÏƒÎ· Î‘ÏÎ½Î·Î¸ÎµÎ¯ÏƒÎ±: Î¤Î¿ email Î´ÎµÎ½ Î­Ï‡ÎµÎ¹ ÎµÏ€Î¹Î²ÎµÎ²Î±Î¹Ï‰Î¸ÎµÎ¯!</div>
            <button class="btn btn-yellow" onclick="attemptLogin()">Î•Î¯ÏƒÎ¿Î´Î¿Ï‚</button>
            <p>ÎÎ­Î¿Ï‚ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚; <a href="#" onclick="showView('register-screen')">Î•Î³Î³ÏÎ±Ï†Î® ÎµÎ´Ï</a></p>
        </div>

        <div id="security-box" class="hidden">
            <div id="turnstile-container" style="display:flex; justify-content:center; margin:15px 0;"></div>
            <p>Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ· Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚...</p>
        </div>

        <div style="background:#fff9c4; padding:10px; margin-top:20px; border-radius:8px; font-size:13px;">
            ğŸ“§ Î¥Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î·: akisss70@gmail.com
        </div>
    </div>

    <div id="register-screen" class="hidden container">
        <h2>Î•Î³Î³ÏÎ±Ï†Î® Î§ÏÎ®ÏƒÏ„Î·</h2>
        <input type="text" id="reg-name" placeholder="ÎŸÎ½Î¿Î¼Î±Ï„ÎµÏ€ÏÎ½Ï…Î¼Î¿">
        <input type="email" id="reg-email" placeholder="Email Î”Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·">
        <input type="password" id="reg-pass" placeholder="ÎšÏ‰Î´Î¹ÎºÏŒÏ‚ (8+ Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÎµÏ‚)">
        <select id="reg-role">
            <option value="passenger">Î•Ï€Î¹Î²Î¬Ï„Î·Ï‚</option>
            <option value="driver">ÎŸÎ´Î·Î³ÏŒÏ‚</option>
        </select>
        <button class="btn btn-dark" onclick="processRegistration()">Î•Î³Î³ÏÎ±Ï†Î® & Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î® Email</button>
        <button class="btn" onclick="location.reload()">Î Î¯ÏƒÏ‰</button>
    </div>

    <div id="verify-screen" class="hidden container">
        <div style="font-size: 50px;">ğŸ“§</div>
        <h2>Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î¿ Email ÏƒÎ±Ï‚!</h2>
        <p>Î£Ï„ÎµÎ¯Î»Î±Î¼Îµ Î­Î½Î±Î½ ÏƒÏÎ½Î´ÎµÏƒÎ¼Î¿ ÎµÏ€Î¹Î²ÎµÎ²Î±Î¯Ï‰ÏƒÎ·Ï‚ ÏƒÏ„Î¿ email ÏƒÎ±Ï‚. Î ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎºÎ¬Î½ÎµÏ„Îµ ÎºÎ»Î¹Îº Î³Î¹Î± Î½Î± ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î¿ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒÏ‚ ÏƒÎ±Ï‚.</p>
        <hr>
        <p style="font-size:12px; color:#666;">Î‘Ï†Î¿Ï ÎµÏ€Î¹Î²ÎµÎ²Î±Î¹ÏÏƒÎµÏ„Îµ ÏƒÏ„Î¿ email ÏƒÎ±Ï‚, Ï€Î±Ï„Î®ÏƒÏ„Îµ Ï„Î¿ ÎºÎ¿Ï…Î¼Ï€Î¯ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰:</p>
        <button class="btn btn-yellow" onclick="confirmEmailLocally()">Î•Ï€Î¹Î²ÎµÎ²Î±Î¯Ï‰ÏƒÎ± Ï„Î¿ Email</button>
    </div>

    <div id="dashboard-hub" class="hidden container">
        <h2 style="color:green">âœ“ Î£Ï…Î½Î´Î­Î¸Î·ÎºÎµ ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚</h2>
        <p>Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Dashboard:</p>
        <button class="btn btn-yellow" onclick="showView('passenger-view'); initMap();">Î§Î¬ÏÏ„Î·Ï‚ Î•Ï€Î¹Î²Î¬Ï„Î·</button>
        <button class="btn btn-yellow" onclick="alert('Driver Dashboard coming soon')">Î Î¯Î½Î±ÎºÎ±Ï‚ ÎŸÎ´Î·Î³Î¿Ï</button>
        <button class="btn btn-dark" onclick="location.reload()">Î‘Ï€Î¿ÏƒÏÎ½Î´ÎµÏƒÎ·</button>
    </div>

    <div id="passenger-view" class="hidden container">
        <h3>ğŸ“ Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î± Î¤Î±Î¾Î¯ (5km)</h3>
        <div id="map-area"></div>
        <button class="btn btn-dark" onclick="showView('dashboard-hub')">Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î®</button>
    </div>

    <nav class="nav-bar">
        <div class="nav-item" onclick="location.reload()">ğŸ <br>Home</div>
        <div class="nav-item" onclick="window.location.href='tel:+306999222446'">ğŸ“<br>Call</div>
        <div class="nav-item" onclick="alert('Contact: akisss70@gmail.com')">ğŸ“§<br>Contact</div>
    </nav>

    <script>
    const API_TOKEN = "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9..."; // Your Full Token Here
    const GROUP_ID = "180133767592019782"; // Your MailerLite Group ID
    const OWNER_PASS = "Aggelos2026!";

    function showView(id) {
        document.querySelectorAll('.container').forEach(c => c.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
    }

    async function processRegistration() {
        const email = document.getElementById('reg-email').value;
        const pass = document.getElementById('reg-pass').value;
        const name = document.getElementById('reg-name').value;

        if(!email.includes('@') || pass.length < 8) return alert("Î›Î¬Î¸Î¿Ï‚ ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î±!");

        // 1. Store locally (Locked state)
        localStorage.setItem('u_email', email);
        localStorage.setItem('u_pass', pass);
        localStorage.setItem('u_verified', 'false');

        // 2. MailerLite API Call
        try {
            await fetch('https://connect.mailerlite.com/api/subscribers', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${API_TOKEN}`
                },
                body: JSON.stringify({
                    email: email,
                    fields: { name: name },
                    groups: [GROUP_ID]
                })
            });
        } catch(e) { console.log("Email trigger attempted."); }

        showView('verify-screen');
    }

    function confirmEmailLocally() {
        localStorage.setItem('u_verified', 'true');
        alert("ÎŸ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒÏ‚ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î®Î¸Î·ÎºÎµ! ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯Ï„Îµ.");
        location.reload();
    }

    function attemptLogin() {
        const email = document.getElementById('login-email').value;
        const pass = document.getElementById('login-pass').value;
        
        // Owner Bypass
        if(pass === OWNER_PASS) {
            showView('dashboard-hub');
            return;
        }

        const sEmail = localStorage.getItem('u_email');
        const sPass = localStorage.getItem('u_pass');
        const sVerified = localStorage.getItem('u_verified');

        if(email === sEmail && pass === sPass && sVerified === 'true') {
            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('security-box').classList.remove('hidden');
            turnstile.render('#turnstile-container', {
                sitekey: '0x4AAAAAACgb7i5zYwkXn5g5',
                callback: () => showView('dashboard-hub')
            });
        } else {
            const err = document.getElementById('login-err');
            err.classList.remove('hidden');
            err.innerText = (sVerified !== 'true' && email === sEmail) ? "âŒ Î•ÎºÎºÏÎµÎ¼ÎµÎ¯ Î· ÎµÏ€Î¹Î²ÎµÎ²Î±Î¯Ï‰ÏƒÎ· email!" : "âŒ Î›Î¬Î¸Î¿Ï‚ email Î® ÎºÏ‰Î´Î¹ÎºÏŒÏ‚!";
        }
    }

    function initMap() {
        navigator.geolocation.getCurrentPosition(pos => {
            const map = L.map('map-area').setView([pos.coords.latitude, pos.coords.longitude], 14);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
            L.circle([pos.coords.latitude, pos.coords.longitude], {radius: 5000, color: 'gold'}).addTo(map);
            L.marker([pos.coords.latitude, pos.coords.longitude]).addTo(map).bindPopup("Î•ÏƒÎµÎ¯Ï‚").openPopup();
        });
    }
    </script>
</body>
</html>
