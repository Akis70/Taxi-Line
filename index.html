<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taxi-Line | Management System</title>
    <style>
        :root { --yellow: #FFD700; --dark: #333; --light: #f4f4f4; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--light); margin: 0; padding: 20px; text-align: center; }
        .container { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); max-width: 500px; margin: 20px auto; }
        .hidden { display: none !important; }
        .btn { padding: 12px 24px; margin: 10px; cursor: pointer; border: none; border-radius: 8px; font-weight: bold; transition: 0.3s; }
        .btn-yellow { background: var(--yellow); color: black; }
        .btn-yellow:hover { background: #e6c200; }
        .btn-dark { background: var(--dark); color: white; }
        input { width: 80%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; }
        
        /* Map Styles */
       
        /* Table Styles */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { padding: 12px; border-bottom: 1px solid #eee; text-align: left; }
        
        /* Rating Stars */
        .stars { font-size: 35px; color: var(--yellow); cursor: pointer; margin: 15px 0; }
        footer { margin-top: 40px; font-size: 13px; color: #888; border-top: 1px solid #ccc; padding-top: 20px; }
#map-area {
        height: 400px; 
        width: 100%;
        border: 2px solid #333;
        border-radius: 8px;
        z-index: 1;
    }
    #taxi-42 { display: none; } /* We can hide the old emoji box now! */
</style>

<script src="https://challenges.cloudflare.com/turnstile/v0/api.js" render="explicit" async defer></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" render=explicit async defer></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>

<div id="main-content" class="container">
    <h1 style="color:var(--dark)">Taxi-Line</h1>
    <div id="auth-section">
        <p>Please enter your credentials</p>
        <input type="email" id="user-input" placeholder="Email Address">
        <input type="password" id="pass-input" placeholder="Password (8+ chars)">
        <br>
        <button class="btn btn-yellow" onclick="handleLogin()">Sign Up / Log In</button>
    </div>
</div>

<div id="dashboards" class="hidden container">
    <h2>Access Control Hub</h2>
    <p>Select your dashboard role:</p>
    <button class="btn btn-yellow" onclick="showView('passenger')">Passenger</button>
    <button class="btn btn-yellow" onclick="showView('driver')">Driver</button>
    <button class="btn btn-dark" onclick="showView('admin')">Head-Admin</button>
</div>

<div id="passenger-view" class="hidden container">
    <h2 id="pass-title">Live Tracking (5km Radius)</h2>
    <div id="map-area"><div id="taxi-42">ðŸš•</div></div>
    
    <div id="rating-section" class="hidden">
        <h3>Rate your Ride</h3>
        <div class="stars">
            <span onclick="submitRating(1)">â˜…</span><span onclick="submitRating(2)">â˜…</span><span onclick="submitRating(3)">â˜…</span><span onclick="submitRating(4)">â˜…</span><span onclick="submitRating(5)">â˜…</span>
        </div>
    </div>

    <button id="finish-btn" class="btn btn-yellow" onclick="endRide()">Finish Ride</button>
    <button class="btn btn-dark" onclick="location.reload()">Logout</button>
</div>

<div id="driver-view" class="hidden container">
    <h2 id="driver-title">Driver Dashboard</h2>
    <div id="driver-status-box">
        <p>Status: <span style="color: green; font-weight: bold;">Available</span></p>
        <div style="background: #fffde7; padding: 15px; border: 1px solid #fbc02d; border-radius: 8px;">
            <p><strong>Active Job:</strong> Passenger pickup at Gate A</p>
            <button class="btn btn-yellow" id="arrive-btn" onclick="driverArrived()">I Have Arrived</button>
        </div>
    </div>
    <button class="btn btn-dark" style="margin-top:20px" onclick="location.reload()">Logout</button>
</div>

<div id="admin-view" class="hidden container">
    <h2>Head-Administrator</h2>
    <table>
        <thead>
            <tr style="background:#f9f9f9"><th>Driver Name</th><th>Status</th><th>Action</th></tr>
        </thead>
        <tbody>
            <tr>
                <td>Ioannis Papadopoulos</td>
                <td id="status-ioannis" style="color: orange;">Pending</td>
                <td><button class="btn-yellow" style="padding:5px 10px; border-radius:4px; border:none; cursor:pointer;" onclick="approveDriver()">Approve</button></td>
            </tr>
        </tbody>
    </table>
    <button class="btn btn-dark" style="margin-top:20px" onclick="location.reload()">Back to Home</button>
</div>

<footer>
    <p>Support: support@taxi-line.com | Phone: +30 6999222446</p>
    <p>Copyright 2026 Taxi-Line Services. All rights reserved.</p>
</footer>

<script>
// --- GLOBAL NAVIGATION ---
function handleLogin() {
    var p = document.getElementById('pass-input').value;
    if (p.length >= 8) {
        // 1. Create the HTML for the widget and the button
        document.getElementById('auth-section').innerHTML = 
            '<h3>Security Check</h3>' +
            '<div id="turnstile-container" style="margin-bottom:15px; display:flex; justify-content:center;"></div>' + 
            '<button id="bypass-btn" class="btn btn-yellow" onclick="bypass()" disabled>Wait for Verification...</button>';
        
        // 2. Tell Cloudflare to put the widget in the container
        if (window.turnstile) {
            turnstile.render('#turnstile-container', {
                sitekey: '0x4AAAAAACgb7i5zYwkXn5g5',
                callback: function(token) {
                    // This part makes the button clickable ONLY after the bot-check passes!
                    document.getElementById('bypass-btn').disabled = false;
                    document.getElementById('bypass-btn').innerText = "Bypass to Dashboards";
                },
            });
        } else {
            // Fallback if the script didn't load
            document.getElementById('bypass-btn').disabled = false;
            document.getElementById('bypass-btn').innerText = "Bypass (Security Offline)";
        }
    } else {
        alert("Password must be at least 8 characters long.");
    }
}

var map;
var taxiMarker;
var moveInterval;

function bypass() {
    // Hide auth, show dashboard as before
    document.getElementById('auth-section').style.display = 'none';
    document.getElementById('dashboard-container').style.display = 'block';

    // 1. Initialize the Real Map
    // We center it on Athens (37.9838, 23.7275)
    map = L.map('map-area').setView([37.9838, 23.7275], 15);

    // 2. Add the actual Map Tiles from OpenStreetMap
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap'
    }).addTo(map);

    // 3. Add the Taxi Marker
    taxiMarker = L.marker([37.9838, 23.7275]).addTo(map)
        .bindPopup('<b>Taxi ID: 4429</b><br>Status: Arriving')
        .openPopup();

    // 4. Start the Real Movement logic
    startRealMovement();
}

function startRealMovement() {
    let lat = 37.9838;
    let lng = 23.7275;

    // Clear any old intervals to prevent "speeding"
    if (moveInterval) clearInterval(moveInterval);

    moveInterval = setInterval(() => {
        // Tiny increments to simulate smooth driving
        lat += (Math.random() - 0.5) * 0.0005;
        lng += (Math.random() - 0.5) * 0.0005;
        
        const newPos = [lat, lng];
        taxiMarker.setLatLng(newPos);
        
        // Optional: Keep the camera centered on the taxi
        // map.panTo(newPos); 
    }, 2000);
}

function showView(v) {
    document.getElementById('dashboards').classList.add('hidden');
    document.getElementById('passenger-view').classList.add('hidden');
    document.getElementById('driver-view').classList.add('hidden');
    document.getElementById('admin-view').classList.add('hidden');
    
    var target = document.getElementById(v + '-view');
    if (target) target.classList.remove('hidden');
    
    if (v === 'passenger') startMap();
}

// --- PASSENGER LOGIC ---
var taxiTimer;
function startMap() {
    if (taxiTimer) clearInterval(taxiTimer);
    taxiTimer = setInterval(function() {
        var taxi = document.getElementById('taxi-42');
        var map = document.getElementById('map-area');
        if (taxi && map) {
            var x = Math.floor(Math.random() * (map.clientWidth - 40));
            var y = Math.floor(Math.random() * (map.clientHeight - 40));
            taxi.style.transform = "translate(" + x + "px, " + y + "px)";
        }
    }, 3000);
}

function endRide() {
    clearInterval(taxiTimer);
    document.getElementById('map-area').style.display = 'none';
    document.getElementById('finish-btn').style.display = 'none';
    document.getElementById('pass-title').innerText = "Arrived at Destination";
    document.getElementById('rating-section').classList.remove('hidden');
}

function submitRating(stars) {
    alert("Rating of " + stars + " stars submitted for Taxi-Line Records.");
    location.reload();
}

// --- DRIVER LOGIC ---
function driverArrived() {
    document.getElementById('driver-title').innerText = "Mission: Privacy Shield Active";
    document.getElementById('driver-status-box').innerHTML = 
        "<p style='color:green'><b>Arrival Confirmed.</b> Passenger location hidden for privacy.</p>";
    alert("Privacy Shield: Passenger GPS data has been redacted from your view.");
}

// --- ADMIN LOGIC ---
function approveDriver() {
    var s = document.getElementById('status-ioannis');
    s.innerText = "Verified";
    s.style.color = "green";
    alert("Ioannis Papadopoulos is now an official Taxi-Line Driver.");
}
</script>

</body>
</html>

