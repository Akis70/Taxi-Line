<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taxi-Line | Î•Î³Î³ÏÎ±Ï†Î®</title>
    <style>
        :root { --primary: #f1c40f; --secondary: #2c3e50; --bg: #f4f4f4; --card: #ffffff; --text: #333; }
        body.dark-mode { --bg: #1a1a1a; --card: #2d2d2d; --text: #f4f4f4; }
        
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; transition: 0.3s; }
        .card { background: var(--card); padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 380px; text-align: center; }
        input, select { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; background: var(--card); color: var(--text); font-size: 15px; }
        .btn { background: var(--secondary); color: white; border: none; padding: 15px; width: 100%; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 16px; margin-top: 10px; transition: 0.2s; }
        .btn:hover { background: #34495e; transform: translateY(-1px); }
        .link { display: block; margin-top: 15px; color: #7f8c8d; text-decoration: none; font-size: 14px; }
        #recaptcha-container { margin: 10px 0; }
    </style>
</head>
<body>

    <div class="card">
        <h2 style="color:var(--secondary)">ğŸš• Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î›Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼Î¿Ï</h2>
        
        <input type="email" id="email" placeholder="Email (Ï€.Ï‡. name@mail.com)">
        <input type="password" id="password" placeholder="ÎšÏ‰Î´Î¹ÎºÏŒÏ‚ (6+ Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÎµÏ‚)">
        <input type="tel" id="phone" placeholder="ÎšÎ¹Î½Î·Ï„ÏŒ Î¤Î·Î»Î­Ï†Ï‰Î½Î¿ (69...)">
        
        <select id="role" onchange="toggleTaxiInput()">
            <option value="passenger">ğŸ‘¤ Î•Ï€Î¹Î²Î¬Ï„Î·Ï‚</option>
            <option value="driver">ğŸš• ÎŸÎ´Î·Î³ÏŒÏ‚ Î¤Î±Î¾Î¯</option>
        </select>

        <input type="text" id="taxi-number" placeholder="Î Î¹Î½Î±ÎºÎ¯Î´Î± / Î‘ÏÎ¹Î¸Î¼ÏŒÏ‚ Î¤Î±Î¾Î¯" style="display:none;">

        <div id="recaptcha-container"></div>

        <button class="btn" onclick="signUp()">Î•Î“Î“Î¡Î‘Î¦Î—</button>
        
        <a href="index.html" class="link">ÎˆÏ‡ÎµÏ„Îµ Î®Î´Î· Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ; Î£ÏÎ½Î´ÎµÏƒÎ·</a>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCCzXoeqv3VODlSH6j3HrqI36ixYYdEjjI",
            authDomain: "taxi-line-f149e.firebaseapp.com",
            databaseURL: "https://taxi-line-f149e-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "taxi-line-f149e",
            storageBucket: "taxi-line-f149e.firebasestorage.app",
            messagingSenderId: "1086896421565",
            appId: "1:1086896421565:web:e498b8916fd95a04e7d5d4"
        };

        // Î‘ÏÏ‡Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        // Î‘ÏÏ‡Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· reCAPTCHA
        window.onload = function() {
            window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
                'size': 'invisible'
            });
        };

        function toggleTaxiInput() {
            const role = document.getElementById('role').value;
            const taxiInput = document.getElementById('taxi-number');
            taxiInput.style.display = (role === 'driver') ? 'block' : 'none';
        }

        async function signUp() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const phone = document.getElementById('phone').value;
            const role = document.getElementById('role').value;
            const taxiNum = document.getElementById('taxi-number').value;

            // Î’Î±ÏƒÎ¹ÎºÏŒÏ‚ Î­Î»ÎµÎ³Ï‡Î¿Ï‚ Ï€ÎµÎ´Î¯Ï‰Î½
            if (!email || password.length < 6 || !phone) {
                alert("Î Î±ÏÎ±ÎºÎ±Î»Ï ÏƒÏ…Î¼Ï€Î»Î·ÏÏÏƒÏ„Îµ ÏƒÏ‰ÏƒÏ„Î¬ ÏŒÎ»Î± Ï„Î± Ï€ÎµÎ´Î¯Î±!");
                return;
            }
            if (role === 'driver' && !taxiNum) {
                alert("Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿Î½ Î±ÏÎ¹Î¸Î¼ÏŒ Ï„Î¿Ï… Ï„Î±Î¾Î¯ ÏƒÎ±Ï‚.");
                return;
            }

            try {
                // Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î§ÏÎ®ÏƒÏ„Î·
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;

                // Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î® Email Î•Ï€Î¹Î²ÎµÎ²Î±Î¯Ï‰ÏƒÎ·Ï‚
                await user.sendEmailVerification();

                // Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Î”ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ ÏƒÏ„Î· Database
                await database.ref('users/' + user.uid).set({
                    uid: user.uid,
                    email: email,
                    phone: phone,
                    role: role,
                    taxiNumber: (role === 'driver') ? taxiNum : null,
                    createdAt: firebase.database.ServerValue.TIMESTAMP
                });

                alert("Î— ÎµÎ³Î³ÏÎ±Ï†Î® Î¿Î»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ! Î£Î±Ï‚ ÏƒÏ„ÎµÎ¯Î»Î±Î¼Îµ email ÎµÏ€Î¹Î²ÎµÎ²Î±Î¯Ï‰ÏƒÎ·Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ»Î­Î³Î¾Ï„Îµ ÎºÎ±Î¹ Ï„Î± Spam.");
                
                // Î‘Ï€Î¿ÏƒÏÎ½Î´ÎµÏƒÎ· Î³Î¹Î± Î½Î± Î±Î½Î±Î³ÎºÎ¬ÏƒÎ¿Ï…Î¼Îµ Ï„Î¿ Login Î¼ÎµÏ„Î¬ Ï„Î·Î½ ÎµÏ€Î¹Î²ÎµÎ²Î±Î¯Ï‰ÏƒÎ·
                await auth.signOut();
                window.location.href = "index.html";

            } catch (error) {
                alert("Î£Ï†Î¬Î»Î¼Î± ÎµÎ³Î³ÏÎ±Ï†Î®Ï‚: " + error.message);
                // Î£Îµ Ï€ÎµÏÎ¯Ï€Ï„Ï‰ÏƒÎ· ÏƒÏ†Î¬Î»Î¼Î±Ï„Î¿Ï‚, ÎºÎ¬Î½Î¿Ï…Î¼Îµ reset Ï„Î¿ recaptcha
                if (window.recaptchaVerifier) {
                    window.recaptchaVerifier.render().then(widgetId => {
                        grecaptcha.reset(widgetId);
                    });
                }
            }
        }

        // Dark Mode Check
        if (localStorage.getItem('darkMode') === 'true') document.body.classList.add('dark-mode');
    </script>
</body>
</html>
