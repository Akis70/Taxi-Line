<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taxi-Line | Admin Panel</title>
    <style>
        :root { --primary: #f1c40f; --secondary: #2c3e50; --dark: #1a252f; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: #f4f7f6; }
        .sidebar { width: 250px; height: 100vh; background: var(--dark); color: white; position: fixed; padding: 20px; }
        .main-content { margin-left: 290px; padding: 30px; }
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; background: white; }
        th, td { padding: 12px; border: 1px solid #ddd; text-align: left; }
        th { background: var(--secondary); color: white; }
        .status-online { color: green; font-weight: bold; }
        .btn-del { background: #e74c3c; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; }
    </style>
</head>
<body>

<div class="sidebar">
    <h2>ğŸ› ï¸ Admin Panel</h2>
    <hr>
    <p>Admin: <span id="admin-email">Î¦ÏŒÏÏ„Ï‰ÏƒÎ·...</span></p>
    <button onclick="location.href='dashboard.html'" style="width:100%; padding:10px; cursor:pointer;">ğŸ  Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î®</button>
</div>

<div class="main-content">
    <h1>Î£Ï„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÎ¬ Î£Ï…ÏƒÏ„Î®Î¼Î±Ï„Î¿Ï‚</h1>
    <div style="display: flex; gap: 20px;">
        <div class="card" style="flex: 1;"><h3>ğŸ‘¥ Î£ÏÎ½Î¿Î»Î¿ Î§ÏÎ·ÏƒÏ„ÏÎ½</h3><h2 id="total-users">0</h2></div>
        <div class="card" style="flex: 1;"><h3>ğŸš• Î•Î½ÎµÏÎ³Î¿Î¯ ÎŸÎ´Î·Î³Î¿Î¯</h3><h2 id="active-drivers">0</h2></div>
        <div class="card" style="flex: 1;"><h3>ğŸ“… Î£ÏÎ½Î¿Î»Î¿ ÎšÎ»Î®ÏƒÎµÏ‰Î½</h3><h2 id="total-rides">0</h2></div>
    </div>

    <div class="card">
        <h3>ğŸ“‹ Î›Î¯ÏƒÏ„Î± Î§ÏÎ·ÏƒÏ„ÏÎ½</h3>
        <table id="users-table">
            <thead><tr><th>Email</th><th>Î¡ÏŒÎ»Î¿Ï‚</th><th>Î¤Î·Î»Î­Ï†Ï‰Î½Î¿</th><th>Î•Î½Î­ÏÎ³ÎµÎ¹ÎµÏ‚</th></tr></thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCCzXoeqv3VODlSH6j3HrqI36ixYYdEjjI",
        authDomain: "taxi-line-f149e.firebaseapp.com",
        databaseURL: "https://taxi-line-f149e-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "taxi-line-f149e",
        storageBucket: "taxi-line-f149e.firebasestorage.app",
        messagingSenderId: "1086896421565",
        appId: "1:1086896421565:web:e498b8916fd95a04e7d5d4"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const database = firebase.database();

    auth.onAuthStateChanged(user => {
        if (user && user.email === "akisss70@gmail.com") {
            document.getElementById('admin-email').innerText = user.email;
            loadData();
        } else {
            alert("Î”ÎµÎ½ Î­Ï‡ÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·!");
            window.location.href = "dashboard.html";
        }
    });

    function loadData() {
        // Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Î§ÏÎ·ÏƒÏ„ÏÎ½
        database.ref('users').on('value', snap => {
            const users = snap.val();
            const tbody = document.querySelector('#users-table tbody');
            tbody.innerHTML = "";
            let count = 0;

            for (let id in users) {
                count++;
                let row = `<tr>
                    <td>${users[id].email}</td>
                    <td>${users[id].role}</td>
                    <td>${users[id].phone}</td>
                    <td><button class="btn-del" onclick="deleteUser('${id}')">Î”Î¹Î±Î³ÏÎ±Ï†Î®</button></td>
                </tr>`;
                tbody.innerHTML += row;
            }
            document.getElementById('total-users').innerText = count;
        });

        // Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Î•Î½ÎµÏÎ³ÏÎ½ ÎŸÎ´Î·Î³ÏÎ½
        database.ref('available_drivers').on('value', snap => {
            document.getElementById('active-drivers').innerText = snap.numChildren();
        });

        // Î¦ÏŒÏÏ„Ï‰ÏƒÎ· ÎšÎ»Î®ÏƒÎµÏ‰Î½
        database.ref('ride_requests').on('value', snap => {
            document.getElementById('total-rides').innerText = snap.numChildren();
        });
    }

    function deleteUser(uid) {
        if(confirm("Î•Î¯ÏƒÏ„Îµ ÏƒÎ¯Î³Î¿Ï…ÏÎ¿Ï‚ Î³Î¹Î± Ï„Î· Î´Î¹Î±Î³ÏÎ±Ï†Î®;")) {
            database.ref('users/' + uid).remove();
        }
    }
</script>
</body>
</html>
